# 南开问卷显示格式更新说明

## 更新时间
2025-12-01

## 更新内容

### 1. 题目内容来源调整
- **之前**: 题目内容显示"三级指标"列的内容
- **现在**: 题目内容显示"打分标准"列的完整内容（包含评价标准和选项）

### 2. 显示格式

每道题目按照以下结构显示：

```
┌─────────────────────────────────────────────────────────┐
│ 序号: 1                                                 │
│                                                         │
│ 一级指标: 治理方向性                                     │
│ 二级指标: 党组织参与治理                                 │
│ 三级指标: 党建融入章程                                   │
│                                                         │
│ ─────────────────────────────────────────────────────   │
│                                                         │
│ 题目内容（打分标准）:                                    │
│ A. 明确党组织功能定位 + 发挥作用途径（全部完成）         │
│ B. 仅明确部分内容                                       │
│ C. 未明确                                               │
│                                                         │
│ 📝 填空项:                                              │
│ 章程中党建相关条款数量: ______ 条                        │
│                                                         │
│ 📎 上传佐证材料（可选）                                  │
└─────────────────────────────────────────────────────────┘
```

### 3. 数据映射关系

| Excel列名 | 用途 | 显示位置 |
|----------|------|---------|
| 序号 | 题目编号 | 题目卡片左上角 |
| 一级指标 | 顶层分类 | 指标层级第一行 |
| 二级指标 | 二级分类 | 指标层级第二行 |
| 三级指标 | 具体指标名称 | 指标层级第三行 |
| 打分标准 | **题目内容和选项** | 题目主体内容 |
| 佐证材料 | 填空项和补充说明 | 填空区域 |

### 4. 示例对比

#### Excel数据
```
序号: 1
一级指标: 治理方向性
二级指标: 党组织参与治理
三级指标: 党建融入章程
打分标准: A. 明确党组织功能定位 + 发挥作用途径（全部完成） B. 仅明确部分内容 C. 未明确
佐证材料: 章程中党建相关条款数量：______条
```

#### Web端显示
```
1  治理方向性 > 党组织参与治理 > 党建融入章程

A. 明确党组织功能定位 + 发挥作用途径（全部完成）
B. 仅明确部分内容
C. 未明确

请填写以下信息：
章程中党建相关条款数量（条）: [_____________]
```

### 5. 技术实现

#### 后端代码 (app.py)
```python
# 第883行：使用打分标准作为题目内容
'indicator': str(row['打分标准']) if pd.notna(row['打分标准']) 
             else str(row['三级指标']) if pd.notna(row['三级指标']) else ''
```

#### 前端模板 (nankai_questionnaire_fill.html)
```html
<div class="question-indicators">
    <span class="indicator-label">一级指标:</span>
    <span class="indicator-value level1">{{ q.level1 }}</span>
    
    <span class="indicator-label">二级指标:</span>
    <span class="indicator-value level2">{{ q.level2 }}</span>
    
    <span class="indicator-label">三级指标:</span>
    <span class="indicator-value level3">{{ q.level3 }}</span>
</div>
<div class="question-title">{{ q.indicator }}</div>
```

### 6. 访问地址

- 问卷入口: http://localhost:5000/nankai-survey
- 初级问卷: http://localhost:5000/nankai-questionnaire-fill?level=初级
- 中级问卷: http://localhost:5000/nankai-questionnaire-fill?level=中级
- 高级问卷: http://localhost:5000/nankai-questionnaire-fill?level=高级

### 7. 功能特性

✅ **完整指标层级**: 显示一级、二级、三级指标
✅ **评价标准作为题目**: 直接显示打分标准的完整内容
✅ **智能选项解析**: 自动提取A/B/C/D选项
✅ **填空项提取**: 自动识别"xxx：______xxx"格式的填空
✅ **复选框支持**: 根据选项动态显示复选框列表
✅ **文件上传**: 支持上传佐证材料
✅ **响应式设计**: 适配各种屏幕尺寸

### 8. 验证方法

#### API测试
```bash
curl http://localhost:5000/api/nankai/questionnaire/beginner
```

#### 浏览器测试
1. 访问 http://localhost:5000/nankai-survey
2. 选择问卷级别（初级/中级/高级）
3. 检查题目显示是否包含完整的评价标准
4. 验证填空项是否正确提取
5. 测试选项选择和提交功能

## 更新完成 ✅

所有功能已按照评价指标体系正确配置，题目内容完整显示打分标准，系统可以正常使用。