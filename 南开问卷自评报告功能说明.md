# 南开问卷自评报告功能说明

## 功能概述

系统现已实现**提交问卷后立即显示分数并生成自评报告**的完整功能。

## 实现的功能

### ✅ 1. 问卷提交即时评分

**位置**: [`/api/nankai/submit`](app.py:976)

**功能**:
- 用户提交问卷后，系统立即计算得分
- 支持百分制得分计算（实际得分/满分×100）
- 根据选项自动评分：
  - A选项（已完成）= 100%分值
  - B选项（部分完成）= 80%分值
  - C选项（未完成）= 0%分值

**返回数据**:
```json
{
  "success": true,
  "score": 85.50,           // 百分制得分
  "total_score": 171.00,    // 实际得分
  "max_score": 200.00,      // 满分
  "submission_id": "企业名_20251201_183045"
}
```

### ✅ 2. 结果页面展示

**位置**: [`templates/nankai_result.html`](templates/nankai_result.html:1)

**功能**:
- 显示百分制综合得分
- 显示实际得分和满分
- 根据分数自动评级：
  - 90分以上：优秀
  - 80-89分：良好
  - 70-79分：中等
  - 60-69分：及格
  - 60分以下：需改进
- 显示企业信息和提交时间

### ✅ 3. 自评报告生成

**位置**: [`nankai_report_generator.py`](nankai_report_generator.py:1)

**功能**:
- 点击"生成自评报告"按钮即可生成Word格式报告
- 报告内容包括：

#### 报告结构

1. **封面**
   - 企业名称
   - 评价级别
   - 综合得分
   - 生成日期

2. **企业基本信息**
   - 企业名称、联系人、联系方式
   - 主营业务、企业规模等

3. **评价总览**
   - 得分情况（实际得分、满分、百分制得分）
   - 评价等级（优秀/良好/中等/及格/需改进）
   - 总体评价描述

4. **各维度详细分析**
   - 按一级指标分组
   - 每个维度的得分和完成情况
   - 统计已完成、部分完成、未完成的项目数

5. **优势与不足**
   - 主要优势：列出已完成的项目
   - 主要不足：列出未完成的项目

6. **改进建议**
   - 总体建议：根据得分给出针对性建议
   - 具体改进措施：列出需要改进的具体项目

7. **附录：问卷详细数据**
   - 完整的问卷填报数据表格
   - 包含序号、指标、分值、答案、得分、完成度、说明

### ✅ 4. 报告下载

**API接口**:
- 生成报告：`/api/nankai/generate-report/<submission_id>`
- 下载报告：`/api/nankai/download-report/<filename>`

**存储位置**: `storage/nankai_reports/`

**文件命名**: `自评报告_企业名_时间戳.docx`

## 使用流程

```
1. 用户填写问卷
   ↓
2. 提交问卷
   ↓
3. 系统立即计算分数
   ↓
4. 跳转到结果页面，显示：
   - 百分制得分
   - 实际得分/满分
   - 评价等级
   - 企业信息
   ↓
5. 用户点击"生成自评报告"
   ↓
6. 系统生成Word报告
   ↓
7. 自动下载报告文件
```

## 技术实现

### 后端实现

1. **报告生成器类**: [`NankaiReportGenerator`](nankai_report_generator.py:15)
   - 使用 `python-docx` 库生成Word文档
   - 支持自定义样式和格式
   - 自动分析问卷数据

2. **API路由**: [`app.py`](app.py:1318)
   - `/api/nankai/generate-report/<submission_id>` - 生成报告
   - `/api/nankai/download-report/<filename>` - 下载报告

3. **数据处理**:
   - 读取JSON格式的提交数据
   - 从Excel读取指标体系
   - 计算各维度得分
   - 分析优势与不足

### 前端实现

1. **结果页面**: [`nankai_result.html`](templates/nankai_result.html:1)
   - 显示得分和评级
   - 提供报告生成按钮
   - 异步调用API生成报告

2. **用户交互**:
   - 点击按钮触发报告生成
   - 显示加载状态
   - 自动下载生成的报告
   - 提供成功/失败反馈

## 报告样式

- **字体**: 宋体（正文）、黑体（标题）
- **字号**: 
  - 标题：22磅
  - 一级标题：16磅
  - 二级标题：14磅
  - 正文：12磅
- **颜色**: 
  - 主色调：#2E5090（深蓝色）
  - 强调色：#4472C4（浅蓝色）
- **格式**: 
  - 表格使用"Light Grid Accent 1"样式
  - 段落对齐、行距适中
  - 页面布局清晰

## 数据存储

### 提交数据
- **位置**: `storage/nankai_submissions/`
- **格式**: JSON
- **命名**: `submission_企业名_时间戳.json`
- **内容**: 
  - 企业信息
  - 问卷答案
  - 部分完成说明
  - 得分详情

### 报告文件
- **位置**: `storage/nankai_reports/`
- **格式**: Word (.docx)
- **命名**: `自评报告_企业名_时间戳.docx`

## 优势特点

1. **即时反馈**: 提交问卷后立即显示分数
2. **自动评级**: 根据分数自动判定评价等级
3. **详细报告**: 生成包含多个维度的完整报告
4. **专业格式**: Word格式，便于编辑和打印
5. **数据完整**: 报告包含所有问卷数据和分析结果
6. **用户友好**: 一键生成，自动下载

## 后续优化建议

1. **报告模板定制**: 支持不同行业的报告模板
2. **图表展示**: 在报告中添加得分雷达图、柱状图等
3. **对标分析**: 与同行业企业进行对比分析
4. **历史对比**: 支持查看历史提交的得分变化
5. **PDF导出**: 增加PDF格式报告生成
6. **邮件发送**: 自动将报告发送到企业邮箱
7. **在线预览**: 支持在线预览报告内容

## 相关文件

- [`nankai_report_generator.py`](nankai_report_generator.py:1) - 报告生成器
- [`app.py`](app.py:976) - 后端API接口
- [`templates/nankai_result.html`](templates/nankai_result.html:1) - 结果页面
- [`templates/nankai_questionnaire_fill.html`](templates/nankai_questionnaire_fill.html:1) - 问卷填写页面

## 测试建议

1. 提交一份完整问卷，验证分数计算是否正确
2. 测试不同得分区间的评级显示
3. 生成报告并检查内容完整性
4. 验证报告格式和样式
5. 测试下载功能是否正常

---

**更新时间**: 2025-12-01
**版本**: v1.0