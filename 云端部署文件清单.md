# 云端部署文件清单

## 📋 部署概述

将工商联门户和企业门户功能部署到云端服务器。

**部署时间**: 2025-12-02  
**系统版本**: v2.1 增强版

---

## 📦 必需文件清单

### 1. 核心应用文件

```
✅ app.py                              # Flask主应用（2450行）
✅ requirements.txt                    # Python依赖包列表
✅ config.json                         # 系统配置文件
```

### 2. 问卷生成模块 (survey_generator/)

```
✅ survey_generator/
   ├── __init__.py
   ├── nankai_questionnaire_generator.py    # Word问卷生成器
   ├── nankai_excel_generator.py            # Excel问卷生成器
   ├── nankai_checkbox_parser.py            # 复选框解析工具
   └── generator.py                         # 通用生成器
```

### 3. 评分和报告模块

```
✅ score_calculator.py                 # 评分计算器
✅ pdf_report_generator.py             # PDF报告生成器（已增强）
✅ industry_analyzer.py                # 行业对比分析模块（新增）
✅ nankai_indicator_loader.py          # 指标加载器
✅ questionnaire_submission_manager.py # 问卷提交管理器
```

### 4. 前端模板文件 (templates/)

```
✅ templates/
   ├── index.html                      # 主页
   ├── portal_chamber.html             # 工商联门户
   ├── portal_enterprise.html          # 企业门户
   ├── nankai_survey_entrance.html     # 南开问卷入口
   ├── nankai_questionnaire.html       # 南开问卷页面
   ├── nankai_questionnaire_fill.html  # 南开问卷填写页面
   ├── nankai_result.html              # 结果页面
   ├── admin_login.html                # 管理员登录
   ├── admin_dashboard.html            # 管理员仪表板
   └── success.html                    # 成功页面
```

### 5. 数据文件

```
✅ nankai_indicators.xlsx              # 南开指标体系文件
✅ user_levels.json                    # 用户等级配置
```

### 6. 存储目录结构

```
✅ storage/                            # 数据存储目录
   ├── submissions/                    # 问卷提交数据
   ├── reports/                        # 生成的报告
   ├── uploads/                        # 上传文件
   └── industry_benchmarks.json        # 行业基准数据（自动生成）
```

---

## 🚫 不需要上传的文件

### 开发和测试文件

```
❌ test_*.py                           # 所有测试文件
❌ *_test.py                           # 测试脚本
❌ verify_*.py                         # 验证脚本
❌ check_*.py                          # 检查脚本
❌ analyze_*.py                        # 分析脚本
❌ review_*.py                         # 审查脚本
```

### 文档文件（可选）

```
❌ *.md                                # Markdown文档
❌ 使用说明.md
❌ README*.md
❌ *说明.md
❌ *指南.md
```

### 临时和缓存文件

```
❌ __pycache__/                        # Python缓存
❌ *.pyc                               # 编译的Python文件
❌ *.pyo                               # 优化的Python文件
❌ .vscode/                            # VSCode配置
❌ .claude/                            # Claude配置
❌ *.log                               # 日志文件
❌ server_run.log                      # 服务器运行日志
```

### 示例和备份文件

```
❌ *.bat                               # Windows批处理文件
❌ *_备份.*                            # 备份文件
❌ 指标体系_备份.xlsx
❌ 企业_*.docx                         # 生成的示例报告
❌ 企业_*.pdf                          # 生成的示例PDF
```

### 特定路径的文件

```
❌ report_generator/                   # 旧版报告生成器
❌ special_submissions/                # 特殊提交数据
❌ survey_generator/output/            # 问卷生成输出（测试数据）
```

---

## 📂 完整目录结构（需要上传）

```
enterprise_report_system/
│
├── app.py                             ✅ 主应用
├── requirements.txt                   ✅ 依赖包
├── config.json                        ✅ 配置文件
│
├── score_calculator.py                ✅ 评分计算
├── pdf_report_generator.py            ✅ PDF报告生成
├── industry_analyzer.py               ✅ 行业对比分析
├── nankai_indicator_loader.py         ✅ 指标加载
├── questionnaire_submission_manager.py ✅ 提交管理
│
├── nankai_indicators.xlsx             ✅ 指标体系
├── user_levels.json                   ✅ 用户等级
│
├── survey_generator/                  ✅ 问卷生成模块
│   ├── __init__.py
│   ├── nankai_questionnaire_generator.py
│   ├── nankai_excel_generator.py
│   ├── nankai_checkbox_parser.py
│   └── generator.py
│
├── templates/                         ✅ 前端模板
│   ├── index.html
│   ├── portal_chamber.html
│   ├── portal_enterprise.html
│   ├── nankai_survey_entrance.html
│   ├── nankai_questionnaire.html
│   ├── nankai_questionnaire_fill.html
│   ├── nankai_result.html
│   ├── admin_login.html
│   ├── admin_dashboard.html
│   └── success.html
│
└── storage/                           ✅ 存储目录
    ├── submissions/                   （空目录，保留结构）
    ├── reports/                       （空目录，保留结构）
    └── uploads/                       （空目录，保留结构）
```

---

## 🔧 部署步骤

### 步骤1: 准备文件

```bash
# 创建部署目录
mkdir enterprise_report_deploy
cd enterprise_report_deploy

# 复制核心文件
cp app.py .
cp requirements.txt .
cp config.json .
cp score_calculator.py .
cp pdf_report_generator.py .
cp industry_analyzer.py .
cp nankai_indicator_loader.py .
cp questionnaire_submission_manager.py .
cp nankai_indicators.xlsx .
cp user_levels.json .

# 复制目录
cp -r survey_generator/ .
cp -r templates/ .

# 创建存储目录
mkdir -p storage/submissions
mkdir -p storage/reports
mkdir -p storage/uploads
```

### 步骤2: 清理不需要的文件

```bash
# 删除测试文件
rm -f test_*.py
rm -f *_test.py
rm -f verify_*.py
rm -f check_*.py

# 删除文档
rm -f *.md

# 删除缓存
rm -rf __pycache__
rm -rf survey_generator/__pycache__
find . -name "*.pyc" -delete
find . -name "*.pyo" -delete

# 删除日志
rm -f *.log

# 删除批处理文件
rm -f *.bat
```

### 步骤3: 上传到云端

```bash
# 使用SCP上传（示例）
scp -r enterprise_report_deploy/ user@your-server:/path/to/deploy/

# 或使用FTP/SFTP工具上传整个目录
```

### 步骤4: 云端配置

```bash
# SSH登录到服务器
ssh user@your-server

# 进入部署目录
cd /path/to/deploy/enterprise_report_deploy

# 安装依赖
pip install -r requirements.txt

# 设置权限
chmod 755 app.py
chmod -R 755 storage/

# 启动应用
python app.py
# 或使用gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

---

## 📋 requirements.txt 内容

确保包含以下依赖：

```txt
Flask>=2.0.0
openpyxl>=3.0.0
python-docx>=0.8.11
reportlab>=3.6.0
matplotlib>=3.5.0
pandas>=1.3.0
xlrd>=2.0.0
gunicorn>=20.1.0
```

---

## ⚙️ config.json 配置

部署前检查配置：

```json
{
  "app": {
    "host": "0.0.0.0",
    "port": 5000,
    "debug": false
  },
  "storage": {
    "submissions": "storage/submissions",
    "reports": "storage/reports",
    "uploads": "storage/uploads"
  },
  "indicators": {
    "file": "nankai_indicators.xlsx"
  }
}
```

---

## 🔒 安全建议

### 1. 环境变量

将敏感信息放入环境变量：

```bash
export SECRET_KEY="your-secret-key"
export DATABASE_URL="your-database-url"
export ADMIN_PASSWORD="your-admin-password"
```

### 2. 文件权限

```bash
# 设置适当的文件权限
chmod 600 config.json
chmod 700 storage/
chmod 644 *.py
```

### 3. 防火墙配置

```bash
# 只开放必要的端口
ufw allow 80/tcp
ufw allow 443/tcp
ufw allow 5000/tcp  # 如果直接运行Flask
```

---

## 🌐 Web服务器配置

### Nginx配置示例

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /static {
        alias /path/to/deploy/enterprise_report_deploy/static;
    }
}
```

---

## 📊 部署检查清单

部署完成后，检查以下功能：

### 工商联门户功能

- [ ] 访问工商联门户页面
- [ ] 生成问卷（初级/中级/高级）
- [ ] 下载问卷Excel文件
- [ ] 查看企业提交列表
- [ ] 生成企业报告
- [ ] 下载PDF报告

### 企业门户功能

- [ ] 访问企业门户页面
- [ ] 填写初级问卷
- [ ] 提交问卷并查看得分
- [ ] 解锁中级问卷（得分≥60）
- [ ] 填写中级问卷
- [ ] 解锁高级问卷（得分≥60）
- [ ] 填写高级问卷
- [ ] 下载自评报告（PDF格式）
- [ ] 接收邮件报告

### 行业对比功能

- [ ] PDF报告包含行业对比章节
- [ ] 显示行业排名和百分位
- [ ] 显示各维度对比分析
- [ ] 显示标杆企业对比

---

## 🐛 常见问题

### 问题1: 模块导入错误

**解决方案**:
```bash
# 确保所有Python文件都已上传
# 检查__init__.py文件是否存在
ls survey_generator/__init__.py
```

### 问题2: 文件权限错误

**解决方案**:
```bash
# 设置storage目录权限
chmod -R 755 storage/
chown -R www-data:www-data storage/
```

### 问题3: 依赖包缺失

**解决方案**:
```bash
# 重新安装依赖
pip install -r requirements.txt --upgrade
```

### 问题4: 中文字体问题

**解决方案**:
```bash
# 安装中文字体
apt-get install fonts-wqy-microhei fonts-wqy-zenhei
fc-cache -fv
```

---

## 📞 技术支持

部署过程中如有问题，请检查：

1. **日志文件**: 查看应用日志了解错误信息
2. **文件完整性**: 确保所有必需文件都已上传
3. **依赖安装**: 确认所有Python包都已正确安装
4. **权限设置**: 检查文件和目录权限
5. **端口占用**: 确保端口5000未被占用

---

## 🎯 快速部署命令

```bash
# 一键部署脚本
#!/bin/bash

# 1. 创建部署目录
mkdir -p ~/enterprise_report_deploy
cd ~/enterprise_report_deploy

# 2. 上传文件（使用你的方法）
# scp -r local_files/* user@server:~/enterprise_report_deploy/

# 3. 安装依赖
pip3 install -r requirements.txt

# 4. 创建存储目录
mkdir -p storage/{submissions,reports,uploads}

# 5. 设置权限
chmod 755 app.py
chmod -R 755 storage/

# 6. 启动应用
nohup python3 app.py > app.log 2>&1 &

echo "部署完成！应用已在后台运行"
echo "访问: http://your-server-ip:5000"
```

---

## 📝 总结

**必需上传的核心文件**:
- ✅ 1个主应用文件 (app.py)
- ✅ 5个核心模块文件
- ✅ 1个问卷生成模块目录（4个文件）
- ✅ 1个模板目录（10个HTML文件）
- ✅ 2个数据文件
- ✅ 1个配置文件
- ✅ 1个依赖文件
- ✅ 3个空存储目录

**总计约**: 25-30个文件 + 目录结构

**不上传**: 测试文件、文档、日志、缓存、示例数据

部署后系统将完整支持工商联门户和企业门户的所有功能！