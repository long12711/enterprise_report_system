# 基础问卷管理系统设计方案

## 一、系统概述

基础问卷管理系统是工商联评价体系的核心模块，用于管理评价指标、评分规则、企业问卷和专家问卷。

### 核心功能
1. **指标体系管理** - 三级指标体系的增删改查
2. **评分规则管理** - 初级、中级、高级评分规则设计
3. **企业问卷管理** - 三个等级的企业问卷管理
4. **专家问卷管理** - 不同类型专家问卷管理

---

## 二、指标体系管理

### 2.1 指标分类

#### 按指标等级分类
```
一级指标 (一级)
├── 二级指标 (二级)
│   ├── 三级指标 (三级)
│   └── 三级指标 (三级)
└── 二级指标 (二级)
    ├── 三级指标 (三级)
    └── 三级指标 (三级)
```

#### 按指标类型分类
```
指标类型
├── 基础类 - 企业必须具备的基础指标
├── 拔高类 - 企业进阶发展的指标
├── 创新类 - 企业创新发展的指标
├── 责任类 - 企业社会责任的指标
└── 其他类 - 其他类型指标
```

### 2.2 指标数据结构

```json
{
  "id": "ind_001",
  "code": "A1",
  "name": "企业基本信息",
  "level": 1,
  "parent_id": null,
  "type": "基础类",
  "description": "企业基本信息评价",
  "weight": 0.2,
  "sort_order": 1,
  "status": "active",
  "children": [
    {
      "id": "ind_002",
      "code": "A1.1",
      "name": "企业规模",
      "level": 2,
      "parent_id": "ind_001",
      "type": "基础类",
      "description": "企业规模评价",
      "weight": 0.5,
      "sort_order": 1,
      "status": "active",
      "children": [
        {
          "id": "ind_003",
          "code": "A1.1.1",
          "name": "员工数量",
          "level": 3,
          "parent_id": "ind_002",
          "type": "基础类",
          "description": "企业员工数量",
          "weight": 1.0,
          "sort_order": 1,
          "status": "active",
          "children": []
        }
      ]
    }
  ]
}
```

### 2.3 数据库设计

#### evaluation_indicators 表
```sql
CREATE TABLE evaluation_indicators (
  id VARCHAR(36) PRIMARY KEY,
  code VARCHAR(50) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  level INT NOT NULL,  -- 1, 2, 3
  parent_id VARCHAR(36),
  type VARCHAR(50),  -- 基础类、拔高类、创新类、责任类、其他类
  description TEXT,
  weight DECIMAL(5, 2),
  sort_order INT,
  status ENUM('active', 'inactive') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  PRIMARY KEY (id),
  UNIQUE KEY uk_code (code),
  INDEX idx_level (level),
  INDEX idx_parent_id (parent_id),
  INDEX idx_type (type),
  FOREIGN KEY (parent_id) REFERENCES evaluation_indicators(id)
);
```

---

## 三、评分规则管理

### 3.1 评分规则结构

```json
{
  "id": "rule_001",
  "indicator_id": "ind_003",
  "level": "初级",
  "score_range": {
    "min": 0,
    "max": 100
  },
  "scoring_criteria": [
    {
      "score": 100,
      "description": "员工数量 >= 500人",
      "condition": "employees >= 500"
    },
    {
      "score": 80,
      "description": "员工数量 >= 200人",
      "condition": "employees >= 200"
    },
    {
      "score": 60,
      "description": "员工数量 >= 50人",
      "condition": "employees >= 50"
    },
    {
      "score": 40,
      "description": "员工数量 >= 10人",
      "condition": "employees >= 10"
    },
    {
      "score": 0,
      "description": "员工数量 < 10人",
      "condition": "employees < 10"
    }
  ],
  "remark": "员工数量评分规则"
}
```

### 3.2 数据库设计

#### scoring_rules 表
```sql
CREATE TABLE scoring_rules (
  id VARCHAR(36) PRIMARY KEY,
  indicator_id VARCHAR(36) NOT NULL,
  level VARCHAR(50) NOT NULL,  -- 初级、中级、高级
  score_min INT DEFAULT 0,
  score_max INT DEFAULT 100,
  criteria JSON,  -- 评分标准
  remark TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  PRIMARY KEY (id),
  UNIQUE KEY uk_indicator_level (indicator_id, level),
  INDEX idx_level (level),
  FOREIGN KEY (indicator_id) REFERENCES evaluation_indicators(id)
);
```

---

## 四、企业问卷管理

### 4.1 问卷结构

```json
{
  "id": "survey_001",
  "name": "初级企业评价问卷",
  "level": "初级",
  "description": "用于初级企业的评价问卷",
  "status": "active",  -- active: 使用, inactive: 关闭
  "usage_scope": ["初级"],
  "total_questions": 50,
  "questions": [
    {
      "id": "q_001",
      "indicator_id": "ind_003",
      "question_text": "贵公司目前有多少名员工？",
      "question_type": "single_choice",  -- single_choice, multiple_choice, text, number
      "options": [
        { "value": "1", "label": "10-50人" },
        { "value": "2", "label": "50-100人" },
        { "value": "3", "label": "100-500人" },
        { "value": "4", "label": "500人以上" }
      ],
      "required": true,
      "sort_order": 1
    }
  ],
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

### 4.2 数据库设计

#### enterprise_surveys 表
```sql
CREATE TABLE enterprise_surveys (
  id VARCHAR(36) PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  level VARCHAR(50) NOT NULL,  -- 初级、中级、高级
  description TEXT,
  status ENUM('active', 'inactive') DEFAULT 'active',
  usage_scope JSON,  -- ["初级", "中级", "高级"]
  total_questions INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  PRIMARY KEY (id),
  INDEX idx_level (level),
  INDEX idx_status (status)
);
```

#### survey_questions 表
```sql
CREATE TABLE survey_questions (
  id VARCHAR(36) PRIMARY KEY,
  survey_id VARCHAR(36) NOT NULL,
  indicator_id VARCHAR(36),
  question_text VARCHAR(500) NOT NULL,
  question_type VARCHAR(50),  -- single_choice, multiple_choice, text, number
  options JSON,
  required BOOLEAN DEFAULT true,
  sort_order INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  PRIMARY KEY (id),
  INDEX idx_survey_id (survey_id),
  INDEX idx_indicator_id (indicator_id),
  FOREIGN KEY (survey_id) REFERENCES enterprise_surveys(id),
  FOREIGN KEY (indicator_id) REFERENCES evaluation_indicators(id)
);
```

---

## 五、专家问卷管理

### 5.1 专家类型

```
专家类型
├── 技术专家 - 评价企业技术水平
├── 管理专家 - 评价企业管理水平
├── 发展专家 - 评价企业发展潜力
├── 财务专家 - 评价企业财务状况
└── 其他专家 - 其他类型专家
```

### 5.2 问卷结构

```json
{
  "id": "expert_survey_001",
  "name": "技术专家评价问卷",
  "expert_type": "技术专家",
  "description": "用于技术专家的评价问卷",
  "status": "active",  -- active: 使用, inactive: 关闭
  "usage_scope": ["技术专家"],
  "total_questions": 30,
  "questions": [
    {
      "id": "eq_001",
      "indicator_id": "ind_005",
      "question_text": "请评价企业的技术创新能力",
      "question_type": "rating",  -- rating: 评分, single_choice, text
      "rating_scale": 5,  -- 5分制或10分制
      "required": true,
      "sort_order": 1
    }
  ]
}
```

### 5.3 数据库设计

#### expert_surveys 表
```sql
CREATE TABLE expert_surveys (
  id VARCHAR(36) PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  expert_type VARCHAR(50) NOT NULL,  -- 技术专家、管理专家、发展专家等
  description TEXT,
  status ENUM('active', 'inactive') DEFAULT 'active',
  usage_scope JSON,  -- 使用范围
  total_questions INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  PRIMARY KEY (id),
  INDEX idx_expert_type (expert_type),
  INDEX idx_status (status)
);
```

#### expert_survey_questions 表
```sql
CREATE TABLE expert_survey_questions (
  id VARCHAR(36) PRIMARY KEY,
  survey_id VARCHAR(36) NOT NULL,
  indicator_id VARCHAR(36),
  question_text VARCHAR(500) NOT NULL,
  question_type VARCHAR(50),  -- rating, single_choice, text
  rating_scale INT,  -- 5 或 10
  required BOOLEAN DEFAULT true,
  sort_order INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  PRIMARY KEY (id),
  INDEX idx_survey_id (survey_id),
  INDEX idx_indicator_id (indicator_id),
  FOREIGN KEY (survey_id) REFERENCES expert_surveys(id),
  FOREIGN KEY (indicator_id) REFERENCES evaluation_indicators(id)
);
```

---

## 六、API 接口设计

### 6.1 指标体系管理接口

#### 获取指标树
```
GET /api/portal/chamber/indicators/tree
Query Parameters:
  - type: 指标类型 (可选)
  - level: 指标等级 (可选)

Response:
{
  "success": true,
  "data": {
    "indicators": [
      {
        "id": "ind_001",
        "code": "A1",
        "name": "企业基本信息",
        "level": 1,
        "type": "基础类",
        "weight": 0.2,
        "children": [...]
      }
    ]
  }
}
```

#### 创建指标
```
POST /api/portal/chamber/indicators
Body:
{
  "code": "A1.1.1",
  "name": "员工数量",
  "level": 3,
  "parent_id": "ind_002",
  "type": "基础类",
  "description": "企业员工数量",
  "weight": 1.0
}
```

#### 更新指标
```
PUT /api/portal/chamber/indicators/:id
Body:
{
  "name": "更新的名称",
  "type": "拔高类",
  "weight": 1.5
}
```

#### 删除指标
```
DELETE /api/portal/chamber/indicators/:id
```

### 6.2 评分规则管理接口

#### 获取评分规则列表
```
GET /api/portal/chamber/scoring-rules
Query Parameters:
  - indicator_id: 指标ID (可选)
  - level: 规则等级 (初级、中级、高级)

Response:
{
  "success": true,
  "data": {
    "rules": [
      {
        "id": "rule_001",
        "indicator_id": "ind_003",
        "level": "初级",
        "criteria": [...]
      }
    ]
  }
}
```

#### 创建评分规则
```
POST /api/portal/chamber/scoring-rules
Body:
{
  "indicator_id": "ind_003",
  "level": "初级",
  "criteria": [
    {
      "score": 100,
      "description": "员工数量 >= 500人",
      "condition": "employees >= 500"
    }
  ]
}
```

#### 更新评分规则
```
PUT /api/portal/chamber/scoring-rules/:id
Body:
{
  "criteria": [...]
}
```

#### 删除评分规则
```
DELETE /api/portal/chamber/scoring-rules/:id
```

### 6.3 企业问卷管理接口

#### 获取企业问卷列表
```
GET /api/portal/chamber/enterprise-surveys
Query Parameters:
  - level: 问卷等级 (初级、中级、高级)
  - status: 状态 (active、inactive)

Response:
{
  "success": true,
  "data": {
    "surveys": [
      {
        "id": "survey_001",
        "name": "初级企业评价问卷",
        "level": "初级",
        "status": "active",
        "total_questions": 50
      }
    ]
  }
}
```

#### 获取企业问卷详情
```
GET /api/portal/chamber/enterprise-surveys/:id

Response:
{
  "success": true,
  "data": {
    "id": "survey_001",
    "name": "初级企业评价问卷",
    "level": "初级",
    "questions": [...]
  }
}
```

#### 创建企业问卷
```
POST /api/portal/chamber/enterprise-surveys
Body:
{
  "name": "初级企业评价问卷",
  "level": "初级",
  "description": "用于初级企业的评价问卷",
  "usage_scope": ["初级"],
  "questions": [...]
}
```

#### 更新企业问卷
```
PUT /api/portal/chamber/enterprise-surveys/:id
Body:
{
  "name": "更新的问卷名称",
  "status": "active",
  "questions": [...]
}
```

#### 删除企业问卷
```
DELETE /api/portal/chamber/enterprise-surveys/:id
```

#### 切换问卷状态
```
PUT /api/portal/chamber/enterprise-surveys/:id/status
Body:
{
  "status": "active"  // 或 "inactive"
}
```

### 6.4 专家问卷管理接口

#### 获取专家问卷列表
```
GET /api/portal/chamber/expert-surveys
Query Parameters:
  - expert_type: 专家类型
  - status: 状态

Response:
{
  "success": true,
  "data": {
    "surveys": [
      {
        "id": "expert_survey_001",
        "name": "技术专家评价问卷",
        "expert_type": "技术专家",
        "status": "active"
      }
    ]
  }
}
```

#### 获取专家问卷详情
```
GET /api/portal/chamber/expert-surveys/:id
```

#### 创建专家问卷
```
POST /api/portal/chamber/expert-surveys
Body:
{
  "name": "技术专家评价问卷",
  "expert_type": "技术专家",
  "description": "用于技术专家的评价问卷",
  "questions": [...]
}
```

#### 更新专家问卷
```
PUT /api/portal/chamber/expert-surveys/:id
Body:
{
  "name": "更新的问卷名称",
  "status": "active"
}
```

#### 删除专家问卷
```
DELETE /api/portal/chamber/expert-surveys/:id
```

---

## 七、前端界面设计

### 7.1 指标体系管理页面

```
┌─────────────────────────────────────────┐
│ 指标类型筛选 | 刷新 | 新增指标          │
├─────────────────────────────────────────┤
│ 指标树形结构展示                         │
│ ├─ A1 企业基本信息 [编辑] [删除]        │
│ │  ├─ A1.1 企业规模 [编辑] [删除]      │
│ │  │  ├─ A1.1.1 员工数量 [编辑][删除]  │
│ │  │  └─ A1.1.2 资产规模 [编辑][删除]  │
│ │  └─ A1.2 企业类型 [编辑] [删除]      │
│ └─ A2 企业发展 [编辑] [删除]           │
└─────────────────────────────────────────┘
```

### 7.2 评分规则管理页面

```
┌─────────────────────────────────────────┐
│ 指标选择 | 规则等级 | 查询 | 新增规则   │
├─────────────────────────────────────────┤
│ 规则列表                                 │
│ 指标 | 等级 | 评分标准 | 操作            │
├─────────────────────────────────────────┤
│ 规则详情编辑区域                         │
└─────────────────────────────────────────┘
```

### 7.3 企业问卷管理页面

```
┌─────────────────────────────────────────┐
│ 问卷等级 | 状态 | 查询 | 新增问卷       │
├─────────────────────────────────────────┤
│ 问卷列表                                 │
│ 名称 | 等级 | 状态 | 问题数 | 操作      │
│ 初级企业评价问卷 | 初级 | 使用 | 50 | [编辑][删除][关闭]
├─────────────────────────────────────────┤
│ 问卷编辑区域                             │
│ 问题列表 | 新增问题 | 删除问题           │
└─────────────────────────────────────────┘
```

### 7.4 专家问卷管理页面

```
┌─────────────────────────────────────────┐
│ 专家类型 | 状态 | 查询 | 新增问卷       │
├─────────────────────────────────────────┤
│ 问卷列表                                 │
│ 名称 | 专家类型 | 状态 | 问题数 | 操作  │
├─────────────────────────────────────────┤
│ 问卷编辑区域                             │
└─────────────────────────────────────────┘
```

---

## 八、业务流程

### 8.1 指标体系建设流程
```
创建一级指标
    ↓
创建二级指标
    ↓
创建三级指标
    ↓
设置指标权重
    ↓
设置指标类型
    ↓
指标体系完成
```

### 8.2 评分规则设计流程
```
选择指标
    ↓
选择规则等级（初级/中级/高级）
    ↓
设计评分标准
    ↓
设置评分条件
    ↓
保存规则
```

### 8.3 问卷设计流程
```
创建问卷
    ↓
选择指标
    ↓
设计问题
    ↓
设置问题类型
    ↓
设置答案选项
    ↓
问卷完成
    ↓
发布问卷（激活）
```

---

## 九、数据验证规则

### 9.1 指标体系验证
- 指标代码唯一性
- 指标名称不为空
- 指标等级必须为1、2或3
- 二级指标必须有一级指标父节点
- 三级指标必须有二级指标父节点
- 权重值在0-1之间

### 9.2 评分规则验证
- 指标必须存在
- 规则等级必须为初级、中级或高级
- 评分标准不能为空
- 评分条件必须有效
- 同一指标同一等级只能有一条规则

### 9.3 问卷验证
- 问卷名称不为空
- 问卷等级必须为初级、中级或高级
- 至少包含一个问题
- 问题文本不为空
- 问题类型必须有效
- 单选题必须有选项

---

## 十、实现优先级

### Phase 1（必须）
- [ ] 指标体系CRUD
- [ ] 指标树形展示
- [ ] 评分规则CRUD
- [ ] 企业问卷CRUD
- [ ] 专家问卷CRUD

### Phase 2（重要）
- [ ] 指标类型筛选
- [ ] 问卷状态管理
- [ ] 问卷预览
- [ ] 问卷复制

### Phase 3（优化）
- [ ] 指标导入导出
- [ ] 规则导入导出
- [ ] 问卷模板库
- [ ] 问卷版本管理

### Phase 4（扩展）
- [ ] 问卷填写
- [ ] 自动评分
- [ ] 评分报告
- [ ] 数据分析

---

## 十一、测试用例

### 测试场景
1. 创建三级指标体系
2. 编辑指标信息
3. 删除指标（检查级联删除）
4. 设计评分规则
5. 创建企业问卷
6. 创建专家问卷
7. 问卷状态切换
8. 问卷预览
9. 权限控制
10. 数据验证


