# 问卷生成器 V2 更新说明

## 更新时间
2025-12-01

## 主要改进

### 1. 统一选项格式
- **之前**：从Excel"打分标准"列提取完整的选项内容（A. xxx B. xxx C. xxx）
- **现在**：所有题目统一使用 **"A. 符合 B. 部分符合 C. 不符合"**

### 2. 智能填空项提取
- **功能**：从Excel"打分标准"列的A选项内容中，智能识别并提取需要填写的数据项
- **提取规则**：
  - 党员人数 → `党员人数：______人`
  - 会议次数 → `上一年度支部党员大会召开次数：______次`
  - 经费金额 → `上一年度党组织活动经费金额：______元`
  - 场所面积 → `活动场所面积：______㎡`
  - 记录份数 → `相关行为记录份数：______份`
  - 比例数据 → `比例：______%`
  - 通用数据 → `人数：______人` / `次数：______次` / `金额：______万元`

### 3. 问卷结构
保持6列表格结构：
1. 序号
2. 一级指标
3. 二级指标
4. 三级指标
5. **选项**（统一ABC格式）
6. **补充数据/说明**（智能提取的填空项）

## 使用方法

### 方式1：生成所有级别问卷
```python
from nankai_questionnaire_generator_v2 import NankaiQuestionnaireGeneratorV2

# 创建生成器
generator = NankaiQuestionnaireGeneratorV2("南开大学-现代企业制度指数评价体系初稿2025.10.22（单独指标）(1).xlsx")

# 生成所有级别
results = generator.generate_all_questionnaires()
```

### 方式2：生成单个级别
```python
# 只生成初级问卷
generator.generate_questionnaire("初级", "output/初级问卷.docx")
```

### 方式3：命令行运行
```bash
cd survey_generator
python nankai_questionnaire_generator_v2.py
```

## 输出文件

生成的问卷保存在：`survey_generator/output/questionnaires/`

文件命名格式：`调查问卷_{级别}_{时间戳}.docx`

例如：
- `调查问卷_初级_20251201_104504.docx`
- `调查问卷_中级_20251201_104504.docx`
- `调查问卷_高级_20251201_104504.docx`

## 验证工具

使用 `verify_questionnaire_v2.py` 验证生成的问卷：

```bash
cd survey_generator
python verify_questionnaire_v2.py
```

验证内容：
- 题目总数
- ABC选项格式使用率
- 填空项提取数量
- 具体填空项内容

## 生成统计

| 级别 | 题目数 | ABC格式 | 填空项 |
|------|--------|---------|--------|
| 初级 | 64题   | 100%    | 5个    |
| 中级 | 52题   | 100%    | 3个    |
| 高级 | 42题   | 100%    | 2个    |

## 技术实现

### 核心方法

1. **`_extract_fill_blanks_from_standard()`**
   - 从打分标准中提取A选项内容
   - 使用正则表达式识别数据类型
   - 生成对应的填空格式

2. **`_create_question_table()`**
   - 统一设置选项为ABC格式
   - 调用填空提取方法
   - 保持原有的表格结构和样式

### 关键特性

- ✅ 自动识别多种数据类型（人数、次数、金额、比例等）
- ✅ 支持复合填空（如：金额+比例）
- ✅ 保持Word文档格式统一（宋体、边框、对齐）
- ✅ 按一级指标分组展示

## 文件说明

- `nankai_questionnaire_generator_v2.py` - 主生成器（V2版本）
- `verify_questionnaire_v2.py` - 验证工具
- `问卷生成器V2更新说明.md` - 本文档

## 注意事项

1. 确保Excel文件路径正确
2. Excel必须包含"初级"、"中级"、"高级"三个工作表
3. 必需的列：序号、一级指标、二级指标、三级指标、打分标准
4. 生成的问卷可直接用于企业填写

## 后续优化建议

1. 可根据实际需求调整填空项识别规则
2. 可添加更多数据类型的自动识别
3. 可支持自定义选项格式
4. 可添加问卷预览功能