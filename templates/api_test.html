<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API æµ‹è¯•å·¥å…·</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: "Microsoft YaHei", Arial, sans-serif; background: #f5f7fa; padding: 20px; }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { color: #333; margin-bottom: 20px; }
    .test-section { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .test-section h2 { color: #4338ca; font-size: 18px; margin-bottom: 15px; border-bottom: 2px solid #4338ca; padding-bottom: 10px; }
    .test-item { margin-bottom: 15px; padding: 10px; background: #f9fafb; border-left: 3px solid #4338ca; }
    .test-item button { padding: 8px 16px; background: #4338ca; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
    .test-item button:hover { background: #3730a3; }
    .result { margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 4px; border-left: 3px solid #0ea5e9; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    .result.success { background: #f0fdf4; border-left-color: #16a34a; }
    .result.error { background: #fef2f2; border-left-color: #ef4444; }
    .status { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
    .status.ok { background: #dcfce7; color: #166534; }
    .status.error { background: #fee2e2; color: #991b1b; }
    .status.pending { background: #fef3c7; color: #92400e; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª API æµ‹è¯•å·¥å…·</h1>
    
    <div class="test-section">
      <h2>å­˜å‚¨æ–‡ä»¶æ£€æŸ¥</h2>
      <div class="test-item">
        <button onclick="checkStorageFiles()">æ£€æŸ¥å­˜å‚¨æ–‡ä»¶</button>
        <div id="storageResult" class="result"></div>
      </div>
    </div>

    <div class="test-section">
      <h2>ä¸“å®¶ç®¡ç† API</h2>
      
      <div class="test-item">
        <strong>è·å–ä¸“å®¶åˆ—è¡¨</strong>
        <button onclick="testGetExperts()">æµ‹è¯•</button>
        <div id="expertsResult" class="result"></div>
      </div>

      <div class="test-item">
        <strong>æ–°å¢ä¸“å®¶</strong>
        <button onclick="testAddExpert()">æµ‹è¯•</button>
        <div id="addExpertResult" class="result"></div>
      </div>

      <div class="test-item">
        <strong>è·å–ä¼ä¸šå¯¹ä¸“å®¶çš„è¯„ä»·</strong>
        <button onclick="testGetEvaluations()">æµ‹è¯•</button>
        <div id="evaluationsResult" class="result"></div>
      </div>
    </div>

    <div class="test-section">
      <h2>ä¼ä¸šç®¡ç† API</h2>
      
      <div class="test-item">
        <strong>è·å–ä¼ä¸šåˆ—è¡¨</strong>
        <button onclick="testGetEnterprises()">æµ‹è¯•</button>
        <div id="enterprisesResult" class="result"></div>
      </div>
    </div>

    <div class="test-section">
      <h2>èµ„è´¨å®¡æ ¸ API</h2>
      
      <div class="test-item">
        <strong>è·å–å®¡æ ¸åˆ—è¡¨</strong>
        <button onclick="testGetReviews()">æµ‹è¯•</button>
        <div id="reviewsResult" class="result"></div>
      </div>
    </div>

    <div class="test-section">
      <h2>ä¸“é¡¹å®¡æ ¸ API</h2>
      
      <div class="test-item">
        <strong>è·å–ä¸“é¡¹ç”³è¯·åˆ—è¡¨</strong>
        <button onclick="testGetSpecials()">æµ‹è¯•</button>
        <div id="specialsResult" class="result"></div>
      </div>
    </div>
  </div>

  <script>
    function setResult(elementId, data, isError = false) {
      const el = document.getElementById(elementId);
      el.className = 'result ' + (isError ? 'error' : 'success');
      el.textContent = JSON.stringify(data, null, 2);
    }

    function checkStorageFiles() {
      const files = [
        'storage/experts.json',
        'storage/expert_evaluations.json',
        'storage/enterprises.json',
        'storage/users.json',
        'storage/special_submissions.json'
      ];
      
      const result = {
        timestamp: new Date().toLocaleString(),
        files: {}
      };
      
      files.forEach(f => {
        result.files[f] = 'âœ“ æ–‡ä»¶åº”è¯¥å­˜åœ¨';
      });
      
      setResult('storageResult', result);
    }

    async function testGetExperts() {
      try {
        const res = await fetch('/api/portal/chamber/experts');
        const data = await res.json();
        setResult('expertsResult', {
          status: res.status,
          data: data,
          count: data.items ? data.items.length : 0
        });
      } catch (e) {
        setResult('expertsResult', { error: e.message }, true);
      }
    }

    async function testAddExpert() {
      try {
        const res = await fetch('/api/portal/chamber/experts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: 'æµ‹è¯•ä¸“å®¶',
            region: 'æµ‹è¯•åœ°åŒº',
            province: 'æµ‹è¯•çœä»½',
            industry: 'æµ‹è¯•è¡Œä¸š',
            level: 'county',
            phone: '13800000000',
            email: 'test@example.com',
            org: 'æµ‹è¯•å•ä½',
            skills: 'æµ‹è¯•æŠ€èƒ½'
          })
        });
        const data = await res.json();
        setResult('addExpertResult', {
          status: res.status,
          data: data
        });
      } catch (e) {
        setResult('addExpertResult', { error: e.message }, true);
      }
    }

    async function testGetEvaluations() {
      try {
        const res = await fetch('/api/portal/chamber/expert-evaluations?expert=å¼ ä¸‰');
        const data = await res.json();
        setResult('evaluationsResult', {
          status: res.status,
          data: data,
          count: data.items ? data.items.length : 0
        });
      } catch (e) {
        setResult('evaluationsResult', { error: e.message }, true);
      }
    }

    async function testGetEnterprises() {
      try {
        const res = await fetch('/api/portal/chamber/enterprises');
        const data = await res.json();
        setResult('enterprisesResult', {
          status: res.status,
          data: data,
          count: data.items ? data.items.length : 0
        });
      } catch (e) {
        setResult('enterprisesResult', { error: e.message }, true);
      }
    }

    async function testGetReviews() {
      try {
        const res = await fetch('/api/portal/chamber/reviews');
        const data = await res.json();
        setResult('reviewsResult', {
          status: res.status,
          data: data,
          count: data.items ? data.items.length : 0
        });
      } catch (e) {
        setResult('reviewsResult', { error: e.message }, true);
      }
    }

    async function testGetSpecials() {
      try {
        const res = await fetch('/api/special/list');
        const data = await res.json();
        setResult('specialsResult', {
          status: res.status,
          data: data,
          count: data.items ? data.items.length : 0
        });
      } catch (e) {
        setResult('specialsResult', { error: e.message }, true);
      }
    }

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥å­˜å‚¨æ–‡ä»¶
    window.addEventListener('load', checkStorageFiles);
  </script>
</body>
</html>

